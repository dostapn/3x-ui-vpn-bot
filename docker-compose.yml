version: "3.8"

services:
  # 3x-ui panel for development
  xui:
    image: ghcr.io/mhsanaei/3x-ui:latest
    container_name: vpn-bot-xui
    restart: unless-stopped
    ports:
      - "2053:8443" # Web panel (internal 8443 -> external 2053)
      - "2096:2096" # Subscription port
      # Add your inbound ports here
      - "54406:54406"
      - "30288:30288"
      - "44972:44972"
      - "18079:18079"
      - "38784:38784"
      - "17666:17666"
      - "22221:22221"
      - "57503:57503"
      - "13927:13927"
    volumes:
      - ./docker/xui-data:/etc/x-ui
    environment:
      - XRAY_VMESS_AEAD_FORCED=false
      - XUI_DISABLE_TG_BOT=true
    networks:
      - vpn-bot-network

  # VPN Bot
  bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: vpn-bot
    restart: unless-stopped
    depends_on:
      - xui
    volumes:
      - ./bot:/app/bot
      - ./docker/xui-data:/app/data
    env_file:
      - .env
    environment:
      - XUI_HOST=http://xui:8443/dostapn-3x-ui
      - DB_PATH=/app/data/x-ui.db
    networks:
      - vpn-bot-network

networks:
  vpn-bot-network:
    driver: bridge
